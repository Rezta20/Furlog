import{Q as E,a as $}from"./QBreadcrumbs-BJ5--SXw.js";import{$ as D,Z as G,a as S,w as h,aa as v,a2 as y,af as O,a4 as r,ag as V,a7 as d,a3 as l,ak as c,aH as M,ac as W,a6 as I,ai as L,aF as z,r as w,o as F,ab as N,al as k,a5 as C,az as H,aj as Z,aI as J}from"./index-IoTA-hBY.js";import{Q as K}from"./QPage-Dgq2Ci5f.js";import{u as X}from"./use-quasar-Bmp2iYOH.js";import{u as Y}from"./usePetStore-65zFUSkh.js";import{u as ee}from"./useCustomerStore-Cj2SR_5v.js";import{_ as ae,a as le}from"./CustomerTable.vue_vue_type_script_setup_true_lang-Bzoeo7-W.js";import{Q as B}from"./QSelect-DK0GUEo6.js";import"./pinia-sul-Gy4R.js";import"./QForm-vhxhsB9S.js";import"./QList-CuhWeu3v.js";import"./QItemLabel-CqtKTuOP.js";import"./format-DjOCFWWD.js";const te={class:"row q-col-gutter-md"},oe={class:"col-6"},ne={class:"col-6"},se={class:"col-6"},de={class:"col-6"},re={class:"col-6"},ue={class:"col-6"},ie={class:"col-12"},me={class:"col-12"},pe={class:"col-6"},ce={class:"col-6"},fe=D({__name:"petInfoCard",props:{pet:{},readonly:{type:Boolean},ownerName:{}},emits:["update:pet","onOwner"],setup(U,{emit:m}){const _=U,g=m,e=G({..._.pet}),i=S(()=>_.ownerName);h(()=>_.pet,n=>{Object.assign(e,n)},{deep:!0,immediate:!0}),h(e,n=>{g("update:pet",{...n})},{deep:!0});function Q(){g("onOwner")}return(n,a)=>(y(),v(O,{class:"q-pa-lg q-mx-auto"},{default:r(()=>[e?(y(),v(V,{key:0},{default:r(()=>[d("div",te,[d("div",oe,[l(c,{modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.name=t),label:"寵物名稱",readonly:n.readonly,dense:""},null,8,["modelValue","readonly"])]),d("div",ne,[l(B,{modelValue:e.petType,"onUpdate:modelValue":a[1]||(a[1]=t=>e.petType=t),options:[{label:"狗",value:"dog"},{label:"貓",value:"cat"},{label:"其他",value:"other"}],label:"寵物種類",readonly:n.readonly,dense:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","readonly"])]),d("div",se,[l(c,{modelValue:e.petBreed,"onUpdate:modelValue":a[2]||(a[2]=t=>e.petBreed=t),label:"品種",readonly:n.readonly,dense:""},null,8,["modelValue","readonly"])]),d("div",de,[l(B,{modelValue:e.petGender,"onUpdate:modelValue":a[3]||(a[3]=t=>e.petGender=t),options:[{label:"公",value:"male"},{label:"母",value:"female"}],label:"性別",readonly:n.readonly,dense:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","readonly"])]),d("div",re,[l(c,{modelValue:e.petAge,"onUpdate:modelValue":a[4]||(a[4]=t=>e.petAge=t),modelModifiers:{number:!0},label:"年齡（歲）",readonly:n.readonly,type:"number",dense:""},null,8,["modelValue","readonly"])]),d("div",ue,[l(c,{modelValue:e.petWeight,"onUpdate:modelValue":a[5]||(a[5]=t=>e.petWeight=t),modelModifiers:{number:!0},label:"體重（kg）",readonly:n.readonly,type:"number",dense:""},null,8,["modelValue","readonly"])]),d("div",ie,[l(c,{modelValue:e.petNote,"onUpdate:modelValue":a[6]||(a[6]=t=>e.petNote=t),label:"備註",readonly:n.readonly,type:"textarea",autogrow:"",dense:""},null,8,["modelValue","readonly"])]),d("div",me,[l(c,{modelValue:i.value,"onUpdate:modelValue":a[7]||(a[7]=t=>i.value=t),label:"飼主",hint:i.value?"":"點擊選擇飼主",readonly:"",dense:"",onClick:Q},M({_:2},[i.value&&e.id!=="create"?{name:"append",fn:r(()=>[l(W,{name:"chevron_right"})]),key:"0"}:void 0]),1032,["modelValue","hint"])]),d("div",pe,[l(c,{modelValue:e.created_at,"onUpdate:modelValue":a[8]||(a[8]=t=>e.created_at=t),label:"建立時間",readonly:"",dense:""},null,8,["modelValue"])]),d("div",ce,[l(c,{modelValue:e.updated_at,"onUpdate:modelValue":a[9]||(a[9]=t=>e.updated_at=t),label:"更新時間",readonly:"",dense:""},null,8,["modelValue"])])])]),_:1})):(y(),v(V,{key:1},{default:r(()=>a[10]||(a[10]=[I(" 目前尚未有該寵物資料")])),_:1,__:[10]}))]),_:1}))}}),ve={class:"flex justify-between q-mb-md"},he=D({__name:"PetDetailPage",setup(U){const m=X(),_=L(),g=z(),e=Y(),i=ee(),Q=w(""),n=w(!1),a=S(()=>i.list.find(u=>u.id===o.value.customer_id)),t=S(()=>a.value?.name??""),b=_.params.id,p=w(!0),o=w({id:"",customer_id:"",name:"",petType:"dog",petBreed:"",petGender:"male",petAge:0,petWeight:0,petNote:"",isAttack:!1,attackNote:"",healthReminder:"",created_at:"",updated_at:""}),P=[{name:"name",label:"姓名",field:"name",align:"left",sortable:!0},{name:"phone",label:"電話",field:"phone",align:"left"},{name:"email",label:"Email",field:"email",align:"left"}];F(()=>{const u=e.fetchPetDetail(b);if(u||(p.value=!1),console.log("pet detail:",u),o.value=u||{...o.value,id:"",created_at:"",updated_at:""},!b){m.notify({type:"negative",message:"找不到該寵物資料"});return}});function q(u){i.filterList(u)}function x(u,s){console.log(s),o.value.customer_id=s.id,Q.value=s.name,n.value=!1,i.filterList({})}async function T(){if(b!=="create"){await g.push(`/customer-list/${a.value?.id}`);return}n.value=!0}function A(){p.value=!1,m.notify({type:"info",message:"已開啟編輯模式"})}function R(){o.value&&(console.log(o.value.petType),o.value.updated_at=new Date().toISOString().slice(0,16).replace("T"," "),e.updatePet(o.value),p.value=!0,m.notify({type:"positive",message:"寵物資料已儲存"}))}async function j(){if(!o.value)return;if(e.list.some(f=>f.name.trim()===o.value.name.trim()&&f.customer_id===o.value.customer_id)){m.notify({type:"negative",message:"已有相同的寵物，請確認是否重複建立"});return}const s=new Date().toISOString().slice(0,16).replace("T"," ");if(o.value.created_at=s,o.value.updated_at=s,o.value.id=crypto.randomUUID(),!o.value.customer_id){m.notify({type:"negative",message:"請選擇一位飼主"});return}e.createPet(o.value),p.value=!0,m.notify({type:"positive",message:"新寵物已建立"}),await g.push("/pet-list")}return(u,s)=>(y(),v(K,{padding:""},{default:r(()=>[d("div",ve,[l(E,{class:"q-mb-xs text-h6 text-bold"},{default:r(()=>[l($,{label:"寵物清單",to:"/pet-list"}),l($,{label:"寵物詳情"})]),_:1}),d("div",null,[p.value&&k(b)?(y(),v(C,{key:0,label:"編輯",color:"primary",onClick:A})):N("",!0),!p.value&&k(b)!=="create"?(y(),v(C,{key:1,label:"儲存",color:"primary",onClick:R})):N("",!0),!p.value&&k(b)==="create"?(y(),v(C,{key:2,label:"建立",color:"primary",disable:!o.value.name,onClick:j},null,8,["disable"])):N("",!0)])]),l(fe,{pet:o.value,readonly:p.value,ownerName:t.value,onOnOwner:T,"onUpdate:pet":s[0]||(s[0]=f=>o.value=f)},null,8,["pet","readonly","ownerName"]),l(H,{modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=f=>n.value=f)},{default:r(()=>[l(O,{style:{"min-width":"700px","max-width":"90vw"}},{default:r(()=>[l(V,{class:"text-h6 q-pb-sm"},{default:r(()=>s[3]||(s[3]=[I("選擇飼主")])),_:1,__:[3]}),l(Z),l(V,null,{default:r(()=>[l(ae,{onSearch:q})]),_:1}),l(V,null,{default:r(()=>[l(le,{rows:k(i).list,columns:P,"row-key":"id",onRowClick:x},null,8,["rows"])]),_:1}),l(J,{align:"right"},{default:r(()=>[l(C,{flat:"",label:"取消",color:"primary",onClick:s[1]||(s[1]=f=>n.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{he as default};
