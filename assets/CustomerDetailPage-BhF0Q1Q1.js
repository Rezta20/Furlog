import{Q as w,a as V}from"./QBreadcrumbs-602MOsmx.js";import{$,a as h,ai as E,aF as N,r as g,o as P,aa as c,a2 as d,a4 as s,a7 as u,a3 as t,ab as _,al as f,a5 as y,af as Q,ag as T,ak as i,a1 as L,a8 as F,a9 as O,a6 as C,ad as p,ac as R}from"./index-CZwW8cOr.js";import{Q as k}from"./QItemLabel-DJqsCHHP.js";import{Q as j,a as A,b as x}from"./QList-fhd9mqbp.js";import{Q as G}from"./QPage-BeCYOgXR.js";import{u as M}from"./use-quasar-Dfk-N9mn.js";import{u as z}from"./useCustomerStore-DuHeVKbP.js";import{u as H}from"./usePetStore-BvXgm67o.js";import"./pinia-6rcpwu4V.js";const J={class:"flex justify-between q-mb-md"},K={class:"row q-col-gutter-md"},W={class:"col-6"},X={class:"col-6"},Y={class:"col-6"},Z={class:"col-12"},ee={class:"col-6"},ae={class:"col-6"},pe=$({__name:"CustomerDetailPage",setup(te){const S=H(),q=h(()=>S.list.filter(r=>r.customer_id===n)),I=E(),b=N(),v=z(),m=M(),n=I.params.id,o=g(!0),e=g({id:"",name:"",phone:"",email:"",note:"",created_at:"",updated_at:""});P(()=>{const r=v.fetchCustomerDetail(n);if(r||(o.value=!1),e.value=r||{id:"",name:"",phone:"",email:"",note:"",created_at:"",updated_at:""},!n){m.notify({type:"negative",message:"找不到該顧客資料"});return}});function B(){e.value&&(e.value.updated_at=new Date().toISOString().slice(0,16).replace("T"," "),v.updateCustomer(e.value),o.value=!0,m.notify({type:"positive",message:"顧客資料已儲存"}))}function D(){o.value=!1,m.notify({type:"info",message:"已開啟編輯模式"})}async function U(){if(!e.value)return;if(v.list.some(l=>l.name.trim()===e.value.name.trim())){m.notify({type:"negative",message:"已有相同姓名的顧客，請確認是否重複建立"});return}e.value.created_at=new Date().toISOString().slice(0,16).replace("T"," "),e.value.updated_at=e.value.created_at,e.value.id=crypto.randomUUID(),v.createCustomer(e.value),o.value=!0,m.notify({type:"positive",message:"新顧客已建立"}),await b.push("/customer-list")}return(r,l)=>(d(),c(G,{padding:""},{default:s(()=>[u("div",J,[t(w,{class:"q-mb-xs text-h6 text-bold"},{default:s(()=>[t(V,{label:"顧客清單",to:"/customer-list"}),t(V,{label:"顧客詳情"})]),_:1}),u("div",null,[o.value&&f(n)?(d(),c(y,{key:0,label:"編輯",color:"primary",onClick:D})):_("",!0),!o.value&&f(n)!="create"?(d(),c(y,{key:1,label:"儲存",color:"primary",onClick:B})):_("",!0),!o.value&&f(n)=="create"?(d(),c(y,{key:2,label:"建立",color:"primary",disable:!e.value.name,onClick:U},null,8,["disable"])):_("",!0)])]),t(Q,{class:"q-pa-lg q-mx-auto"},{default:s(()=>[t(T,null,{default:s(()=>[u("div",K,[u("div",W,[t(i,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.name=a),label:"姓名",readonly:o.value,dense:""},null,8,["modelValue","readonly"])]),u("div",X,[t(i,{modelValue:e.value.phone,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.phone=a),label:"電話",readonly:o.value,dense:""},null,8,["modelValue","readonly"])]),u("div",Y,[t(i,{modelValue:e.value.email,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.email=a),label:"Email",readonly:o.value,dense:""},null,8,["modelValue","readonly"])]),u("div",Z,[t(i,{modelValue:e.value.note,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.note=a),label:"顧客備註",readonly:o.value,type:"textarea",autogrow:"",dense:""},null,8,["modelValue","readonly"])]),u("div",ee,[t(i,{modelValue:e.value.created_at,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.created_at=a),label:"建立時間",readonly:"",dense:""},null,8,["modelValue"])]),u("div",ae,[t(i,{modelValue:e.value.updated_at,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.updated_at=a),label:"更新時間",readonly:"",dense:""},null,8,["modelValue"])])])]),_:1})]),_:1}),t(Q,{class:"q-mt-md q-pa-md"},{default:s(()=>[l[6]||(l[6]=u("div",{class:"text-subtitle1 q-mb-sm"},"飼養的寵物",-1)),t(j,{bordered:"",separator:""},{default:s(()=>[(d(!0),L(F,null,O(q.value,a=>(d(),c(A,{key:a.id,clickable:"",onClick:le=>f(b).push(`/pet-list/${a.id}`)},{default:s(()=>[t(x,null,{default:s(()=>[t(k,null,{default:s(()=>[C(p(a.name)+"（"+p(a.petType)+"）",1)]),_:2},1024),t(k,{caption:""},{default:s(()=>[C(p(a.petBreed)+"，"+p(a.petGender)+"，"+p(a.petAge)+"歲",1)]),_:2},1024)]),_:2},1024),t(x,{side:""},{default:s(()=>[t(R,{name:"navigate_next"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1,__:[6]})]),_:1}))}});export{pe as default};
