import{a as w,b as V,Q as g}from"./QItemLabel-niFXh2eN.js";import{$,a as h,as as E,aK as N,r as C,n as P,aa as c,a2 as r,a4 as s,a7 as u,a3 as t,ab as _,aq as f,a5 as y,af as Q,ag as T,ap as i,a1 as L,a8 as O,a9 as R,a6 as k,ad as p,ac as j}from"./index-R3yB58JB.js";import{Q as A,a as F,b as x}from"./QList-CDL4SHx_.js";import{Q as G}from"./QPage-CqMv33C4.js";import{u as K}from"./use-quasar-CWKXfB3t.js";import{u as M}from"./useCustomerStore-DJnbZrme.js";import{u as z}from"./usePetStore-BhVjx8-K.js";import"./pinia-CnhOXe-T.js";const H={class:"flex justify-between q-mb-md"},J={class:"row q-col-gutter-md"},W={class:"col-6"},X={class:"col-6"},Y={class:"col-6"},Z={class:"col-12"},ee={class:"col-6"},ae={class:"col-6"},ce=$({__name:"CustomerDetailPage",setup(te){const S=z(),q=h(()=>S.list.filter(d=>d.customer_id===n)),I=E(),b=N(),v=M(),m=K(),n=I.params.id,o=C(!0),e=C({id:"",name:"",phone:"",email:"",note:"",created_at:"",updated_at:""});P(()=>{const d=v.fetchCustomerDetail(n);if(d||(o.value=!1),e.value=d||{id:"",name:"",phone:"",email:"",note:"",created_at:"",updated_at:""},!n){m.notify({type:"negative",message:"找不到該顧客資料"});return}});function B(){e.value&&(e.value.updated_at=new Date().toISOString().slice(0,16).replace("T"," "),v.updateCustomer(e.value),o.value=!0,m.notify({type:"positive",message:"顧客資料已儲存"}))}function D(){o.value=!1,m.notify({type:"info",message:"已開啟編輯模式"})}async function U(){if(!e.value)return;if(v.list.some(l=>l.name.trim()===e.value.name.trim())){m.notify({type:"negative",message:"已有相同姓名的顧客，請確認是否重複建立"});return}e.value.created_at=new Date().toISOString().slice(0,16).replace("T"," "),e.value.updated_at=e.value.created_at,e.value.id=crypto.randomUUID(),v.createCustomer(e.value),o.value=!0,m.notify({type:"positive",message:"新顧客已建立"}),await b.push("/customer-list")}return(d,l)=>(r(),c(G,{padding:""},{default:s(()=>[u("div",H,[t(w,{class:"q-mb-xs text-h6 text-bold"},{default:s(()=>[t(V,{label:"顧客清單",to:"/customer-list"}),t(V,{label:"顧客詳情"})]),_:1}),u("div",null,[o.value&&f(n)?(r(),c(y,{key:0,label:"編輯",color:"primary",onClick:D})):_("",!0),!o.value&&f(n)!="create"?(r(),c(y,{key:1,label:"儲存",color:"primary",onClick:B})):_("",!0),!o.value&&f(n)=="create"?(r(),c(y,{key:2,label:"建立",color:"primary",disable:!e.value.name,onClick:U},null,8,["disable"])):_("",!0)])]),t(Q,{class:"q-pa-lg q-mx-auto"},{default:s(()=>[t(T,null,{default:s(()=>[u("div",J,[u("div",W,[t(i,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.name=a),label:"姓名",readonly:o.value,dense:""},null,8,["modelValue","readonly"])]),u("div",X,[t(i,{modelValue:e.value.phone,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.phone=a),label:"電話",readonly:o.value,dense:""},null,8,["modelValue","readonly"])]),u("div",Y,[t(i,{modelValue:e.value.email,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.email=a),label:"Email",readonly:o.value,dense:""},null,8,["modelValue","readonly"])]),u("div",Z,[t(i,{modelValue:e.value.note,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.note=a),label:"顧客備註",readonly:o.value,type:"textarea",autogrow:"",dense:""},null,8,["modelValue","readonly"])]),u("div",ee,[t(i,{modelValue:e.value.created_at,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.created_at=a),label:"建立時間",readonly:"",dense:""},null,8,["modelValue"])]),u("div",ae,[t(i,{modelValue:e.value.updated_at,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.updated_at=a),label:"更新時間",readonly:"",dense:""},null,8,["modelValue"])])])]),_:1})]),_:1}),t(Q,{class:"q-mt-md q-pa-md"},{default:s(()=>[l[6]||(l[6]=u("div",{class:"text-subtitle1 q-mb-sm"},"飼養的寵物",-1)),t(A,{bordered:"",separator:""},{default:s(()=>[(r(!0),L(O,null,R(q.value,a=>(r(),c(F,{key:a.id,clickable:"",onClick:le=>f(b).push(`/pet-list/${a.id}`)},{default:s(()=>[t(x,null,{default:s(()=>[t(g,null,{default:s(()=>[k(p(a.name)+"（"+p(a.petType)+"）",1)]),_:2},1024),t(g,{caption:""},{default:s(()=>[k(p(a.petBreed)+"，"+p(a.petGender)+"，"+p(a.petAge)+"歲",1)]),_:2},1024)]),_:2},1024),t(x,{side:""},{default:s(()=>[t(j,{name:"navigate_next"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1,__:[6]})]),_:1}))}});export{ce as default};
